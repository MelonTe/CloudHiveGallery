# 一、用户上传图片及审核

## 需求分析

因为涉及到给用户上传图片，因此必须存在审核机制，保证系统的安全。

具体分析需求：

1）用户上传创建图片：需要开放权限，允许用户上传图片，功能和流程与管理员上传图片一致，要增加文件校验。

2）管理员审核图片：管理员可用查看和**筛选**所有待审核的图片，标记为通过或拒绝，可填写通过或拒绝的具体原因。还需要**管理员的审核日志信息**。

## 1、审核逻辑

1）管理员可用操作审核的状态流转：

- 默认为“待审核”，可以设置为“审核通过”、“审核拒绝”
- 已拒绝的图片可以重新审核为通过
- 已通过的图片可以撤销为拒绝

2）管理员自动审核：管理员上传、更新图片，允许自动通过审核，填充审核参数为——审核人、审核时间、审核原因如“管理员自动通过审核”

3）用户操作需要审核：用户上传或编辑图片时，图片的状态会被重置为“待审核”。

重复审核时，既可以重置**所有**审核参数，也可以仅重置审核状态。其余参数需要在后端保留。

4）控制内容可见性：对于用户来说，只能看见“审核通过”状态的数据，管理员可以在图片管理页面看到所有数据，并且根据审核状态筛选图片。

Q：考虑并发问题？

A：从并发角度，来思考这个问题。因为图片的审核需要管理员手动执行，不涉及复杂的奖励机制或并发高频请求，误审或重复审核对系统影响不大，不需要过度考虑并发问题。

## 2、库表设计

为了支持审核功能，在picture表新增以下字段，同时优化索引设计用于提升查询性能。

```sql
ALTER TABLE picture  
    -- 添加新列  
    ADD COLUMN reviewStatus INT DEFAULT 0 NOT NULL COMMENT '审核状态：0-待审核; 1-通过; 2-拒绝',  
    ADD COLUMN reviewMessage VARCHAR(512) NULL COMMENT '审核信息',  
    ADD COLUMN reviewerId BIGINT NULL COMMENT '审核人 ID',  
    ADD COLUMN reviewTime DATETIME NULL COMMENT '审核时间';  
  
-- 创建基于 reviewStatus 列的索引  
CREATE INDEX idx_reviewStatus ON picture (reviewStatus);
```

